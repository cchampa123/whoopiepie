FROM python:3.7
RUN apt-get update && \
    apt-get install -y \
      vim \
      wget \
      apache2 \
      libapache2-mod-wsgi-py3

COPY requirements.txt requirements.txt
RUN python -m venv /usr/local/env
ENV PATH=/usr/local/env/bin:$PATH
RUN pip install -r requirements.txt

COPY apache_config_ssl.conf /etc/apache2/sites-available/whoopiepie_ssl.conf
COPY apache_config_standard.conf /etc/apache2/sites-available/whoopiepie_standard.conf
COPY options-ssl-apache.conf /certs/options-ssl-apache.conf

RUN a2dissite default-ssl.conf
RUN a2dissite 000-default.conf
RUN a2ensite whoopiepie_ssl.conf
RUN a2ensite whoopiepie_standard.conf
RUN a2enmod \
    ssl \
    wsgi \
    rewrite

CMD ["/usr/sbin/apache2ctl", "-D", "FOREGROUND"]
