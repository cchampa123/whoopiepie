FROM ubuntu:20.04

ENV TZ=America/New_York
RUN ln -snf /usr/share/zoneinfo/$TZ /etc/localtime && echo $TZ > /etc/timezone

RUN apt-get update && \
    apt-get install -y \
      vim \
      wget \
      apache2

COPY apache_config_ssl.conf /etc/apache2/sites-available/whoopiepie_ssl.conf
COPY apache_config_standard.conf /etc/apache2/sites-available/whoopiepie_standard.conf
COPY options-ssl-apache.conf /certs/options-ssl-apache.conf

RUN a2dissite default-ssl.conf &&\
      a2dissite 000-default.conf &&\
      a2ensite whoopiepie_ssl.conf &&\
      a2ensite whoopiepie_standard.conf &&\
      a2enmod ssl proxy_http proxy_wstunnel rewrite

CMD ["/usr/sbin/apache2ctl", "-D", "FOREGROUND"]
